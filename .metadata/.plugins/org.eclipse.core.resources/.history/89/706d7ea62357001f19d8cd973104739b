/*
 * main_app.h
 *
 * Created on: Aug 6, 2024
 * Author: adith
 */

#ifndef MAIN_APP_INCLUDES_MAIN_APP_H_
#define MAIN_APP_INCLUDES_MAIN_APP_H_

#include "main.h"
#include "states.h"
#include "stdbool.h"

// Peripheral Handles
extern ADC_HandleTypeDef hadc1;
extern DAC_HandleTypeDef hdac;
extern I2C_HandleTypeDef hi2c1;
extern I2C_HandleTypeDef hi2c3;
extern SPI_HandleTypeDef hspi3;
extern TIM_HandleTypeDef htim1;
extern TIM_HandleTypeDef htim2;
extern TIM_HandleTypeDef htim4;
extern TIM_HandleTypeDef htim9;
extern UART_HandleTypeDef huart4;
extern UART_HandleTypeDef huart1;
extern UART_HandleTypeDef huart2;
extern PCD_HandleTypeDef hpcd_USB_OTG_HS;

// Memory Map

#define FLASH_USER_START_ADDR     0x08060000
#define FLASH_USER_END_ADDR       0x0807FFFF

#define RECORDS_START_ADDR        FLASH_USER_START_ADDR
#define RECORDS_SIZE              0x10000 // 64 KB for records

#define ERROR_CODES_START_ADDR    (RECORDS_START_ADDR + RECORDS_SIZE)
#define ERROR_CODES_SIZE          0x4000  // 16 KB for error codes

#define CALIBRATION_START_ADDR    (ERROR_CODES_START_ADDR + ERROR_CODES_SIZE)
#define CALIBRATION_SIZE          0x8000  // 32 KB for calibration data

#define PRODUCT_INFO_START_ADDR   (CALIBRATION_START_ADDR + CALIBRATION_SIZE)
#define PRODUCT_INFO_SIZE         0x4000  // 16 KB for product info

// Ensure we haven't exceeded the available space
#if (PRODUCT_INFO_START_ADDR + PRODUCT_INFO_SIZE) > FLASH_USER_END_ADDR
#error "Flash memory layout exceeds available space"
#endif

// Main loop
void main_app(void);

#endif /* MAIN_APP_INCLUDES_MAIN_APP_H_ */
